# Story 1.5: Automated Tenant Onboarding Saga

**Status:** Approved

## Story
**As a** Superadmin,
**I want** an automated, transactional process to onboard new tenants,
**so that** database schemas, IAM clients, and storage buckets are created consistently without manual error.

## Acceptance Criteria
1. **Atomic Operation**: The creation of a Tenant must either fully succeed or fully fail (clean up resources).
2. **Steps Orchestration**:
    - Step 1: Create Tenant Record in `public` schema (Status: PENDING).
    - Step 2: Create Keycloak Client (Service Account) & Roles via Admin API.
    - Step 3: Create PostgreSQL Schema (`t_{uuid}`) & Run Liquibase.
    - Step 4: Create MinIO Bucket & Policy.
    - Step 5: Update Tenant Record (Status: ACTIVE).
3. **Credentials**: Generate and encrypt client_id/secret, return them ONCE to the admin.
4. **Compensation (Rollback)**: If Step 3 fails, delete Keycloak Client. If Step 4 fails, drop Schema and delete Client.

## Tasks / Subtasks
- [ ] **Service Definition**
    - [ ] Create `TenantOnboardingService`.
- [ ] **Integration Implementations**
    - [ ] Implement `KeycloakAdminClient` (using `keycloak-admin-client` lib).
    - [ ] Implement `MinioAdminClient` (using MinIO Java SDK).
    - [ ] Implement `SchemaProvisioner` (using JDBC DDL + Liquibase API).
- [ ] **Saga Logic**
    - [ ] Implement the sequence with try/catch/compensation blocks.
- [ ] **API Endpoint**
    - [ ] `POST /admin/tenants` -> triggers the Saga.

## Dev Notes
* **Secrets**: Do not log the generated `client_secret`.
* **Idempotency**: Ideally, running the onboarding twice for the same name should return the existing (if completed) or resume.