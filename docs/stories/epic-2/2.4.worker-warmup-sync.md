# Story 2.4: Worker Data Loading & Synchronization

**Status:** Approved

## Story
**As a** System Architect,
**I want** the Worker nodes to automatically load fingerprint templates from the database on startup,
**so that** the in-memory cache is populated and ready for matching.

## Acceptance Criteria
1. **Startup Warm-up**: On application startup (`ApplicationRunner`), the Worker connects to the Tenant Schemas in PostgreSQL.
2. **Data Loading**: It fetches all existing `identities` and `templates`.
3. **Deserialization**: Converts DB binary data into SourceAFIS `FingerprintTemplate` objects in memory.
4. **Multi-tenant Loop**: Iterates through all registered tenants to load their respective caches.
5. **Readiness Probe**: The Worker exposes a Health Check (`/actuator/health`) that is DOWN until warm-up is complete.

## Tasks / Subtasks
- [ ] **Database Access (Worker)**
    - [ ] Configure Read-Only JDBC connection for Worker.
    - [ ] Use `TenantService` to iterate schemas.
- [ ] **Loader Service**
    - [ ] Implement `WarmupService`.
    - [ ] Query: `SELECT rid, template FROM template_table`.
    - [ ] Populate `BiometricStore`.
    - [ ] Log progress.
- [ ] **Sync Mechanism (Basic)**
    - [ ] Listen to `biometric.update` Kafka topic.
    - [ ] Update in-memory cache on new enrollments.
- [ ] **Testing**
    - [ ] Test startup time with mock data.
    - [ ] Verify Health status changes to UP after loading.

## Dev Notes
* **Memory Risk**: This process is the most dangerous for OOM errors. Monitor Heap usage during the bulk load.
* **Latency**: Ensure the Readiness Probe does not flap; it should stay DOWN until *all* data is loaded.
